<div class="reset-page">
	<app-notification-container></app-notification-container>
	
	<div class="reset-content">
		<div class="reset-container">
			<div class="reset-card">
				<div class="card-header">
					<app-brand-logo size="lg" [showText]="true" linkTo="/" variant="gradient"></app-brand-logo>
					<h1 *ngIf="!isSuccess && isSuccess !== false">New Password</h1>
					<h1 *ngIf="isSuccess">Success</h1>
					<h1 *ngIf="isSuccess === false">Failed</h1>
					<p *ngIf="!isSuccess && isSuccess !== false">Create a new password</p>
					<p *ngIf="isSuccess">{{ message }}</p>
					<p *ngIf="isSuccess === false">{{ message }}</p>
				</div>
		
				<div class="reset-body" *ngIf="token && !isSuccess && isSuccess !== false">
					<form [formGroup]="resetForm" (ngSubmit)="onSubmit()" class="form">
						<div class="field">
							<label>New Password</label>
							<div class="input" [class.error]="getFieldError('newPassword')">
								<i class="fas fa-lock"></i>
								<input 
									[type]="showNewPassword ? 'text' : 'password'" 
									id="newPassword" 
									formControlName="newPassword"
									placeholder="Enter your new password"
									[class.is-invalid]="getFieldError('newPassword')"
								>
								<button 
									type="button" 
									class="password-toggle"
									(click)="showNewPassword = !showNewPassword"
									tabindex="-1">
									<i class="fas" [class.fa-eye]="!showNewPassword" [class.fa-eye-slash]="showNewPassword"></i>
								</button>
							</div>
							<div class="field-error" *ngIf="getFieldError('newPassword')">
								<i class="fas fa-exclamation-circle"></i>
								{{ getFieldError('newPassword') }}
							</div>
							<div class="password-validation-errors" *ngIf="passwordValidationErrors.length > 0 && !isValidatingPassword">
								<ul>
									<li *ngFor="let error of passwordValidationErrors">{{ error }}</li>
								</ul>
							</div>
							<div class="password-validating" *ngIf="isValidatingPassword">
								<i class="fas fa-spinner fa-spin"></i> Validating password...
							</div>
						</div>
						
						<div class="field">
							<label>Confirm Password</label>
							<div class="input" [class.error]="getFieldError('confirmPassword')">
								<i class="fas fa-lock"></i>
								<input 
									[type]="showConfirmPassword ? 'text' : 'password'" 
									id="confirmPassword" 
									formControlName="confirmPassword"
									placeholder="Confirm your new password"
									[class.is-invalid]="getFieldError('confirmPassword')"
								>
								<button 
									type="button" 
									class="password-toggle"
									(click)="showConfirmPassword = !showConfirmPassword"
									tabindex="-1">
									<i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
								</button>
							</div>
							<div class="field-error" *ngIf="getFieldError('confirmPassword')">
								<i class="fas fa-exclamation-circle"></i>
								{{ getFieldError('confirmPassword') }}
							</div>
						</div>

						<div class="actions">
							<a class="link" (click)="goToLogin()">
								<i class="fas fa-arrow-left"></i>
								Back to Login
							</a>
						</div>
						
						<button 
							type="submit" 
							class="btn btn-primary btn-lg submit" 
							[disabled]="isResetting || resetForm.invalid">
							<i class="fas fa-check" *ngIf="!isResetting"></i>
							<i class="fas fa-spinner fa-spin" *ngIf="isResetting"></i>
							<span>{{ isResetting ? 'Resetting...' : 'Reset Password' }}</span>
						</button>
					</form>
				</div>

				<div class="success-content" *ngIf="isSuccess">
					<div class="success-message">
						<p>{{ message }}</p>
					</div>
					<div class="success-actions">
						<button type="button" class="btn btn-primary btn-lg" (click)="goToLogin()">
							<i class="fas fa-sign-in-alt"></i>
							<span>Go to Login</span>
						</button>
					</div>
				</div>

				<div class="error-content" *ngIf="isSuccess === false">
					<div class="error-message-box">
						<p>{{ message }}</p>
					</div>
					<div class="error-actions">
						<button type="button" class="btn btn-outline" (click)="goToLogin()">
							<i class="fas fa-arrow-left"></i>
							<span>Back to Login</span>
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
