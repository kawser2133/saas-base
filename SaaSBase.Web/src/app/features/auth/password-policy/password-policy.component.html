<app-notification-container></app-notification-container>

<!-- Page Header -->
<header class="page-header">
  <div class="header-surface">
    <app-breadcrumb></app-breadcrumb>

    <div class="header-main">
      <div class="title-block">
        <div class="title-content">
          <h1 class="page-title">Password Policy</h1>
          <p class="page-description">Manage password requirements and security settings</p>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn btn-primary" (click)="load()" [disabled]="isLoading">
          <i class="fas fa-sync" [class.fa-spin]="isLoading"></i>
          <span>Refresh</span>
        </button>
      </div>
    </div>
  </div>
</header>

<!-- Main Content -->
<div class="password-policy-container" *ngIf="policy">
  <div class="policy-grid">
    <!-- Left Column: Policy Settings -->
    <div class="policy-settings-card">
      <div class="card-header">
        <h2>Policy Settings</h2>
      </div>
      <div class="card-body">
        <!-- Password Length -->
        <div class="settings-group">
          <h3 class="group-title">Password Length</h3>
          <div class="settings-row">
            <div class="setting-item">
              <label class="setting-label">Minimum Length</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="policy.minLength" 
                min="1"
                max="128" />
            </div>
            <div class="setting-item">
              <label class="setting-label">Maximum Length</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="policy.maxLength" 
                min="1"
                max="128" />
            </div>
          </div>
        </div>

        <!-- Character Requirements -->
        <div class="settings-group">
          <h3 class="group-title">Character Requirements</h3>
          <div class="requirement-grid">
            <label class="requirement-option">
              <input type="checkbox" [(ngModel)]="policy.requireUppercase" />
              <span class="option-content">
                <span class="option-title">Uppercase Letters</span>
                <span class="option-desc">A-Z</span>
              </span>
            </label>
            <label class="requirement-option">
              <input type="checkbox" [(ngModel)]="policy.requireLowercase" />
              <span class="option-content">
                <span class="option-title">Lowercase Letters</span>
                <span class="option-desc">a-z</span>
              </span>
            </label>
            <label class="requirement-option">
              <input type="checkbox" [(ngModel)]="policy.requireNumbers" />
              <span class="option-content">
                <span class="option-title">Numbers</span>
                <span class="option-desc">0-9</span>
              </span>
            </label>
            <label class="requirement-option">
              <input type="checkbox" [(ngModel)]="policy.requireSpecialCharacters" />
              <span class="option-content">
                <span class="option-title">Special Characters</span>
                <span class="option-desc">!&#64;#$%^&amp;*</span>
              </span>
            </label>
          </div>
        </div>

        <!-- Security Settings -->
        <div class="settings-group">
          <h3 class="group-title">Security Settings</h3>
          <div class="settings-row">
            <div class="setting-item">
              <label class="setting-label">Password History</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="policy.passwordHistoryCount" 
                min="0"
                max="50" />
              <small class="setting-hint">Previous passwords to remember</small>
            </div>
            <div class="setting-item">
              <label class="setting-label">Expiry Days</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="policy.passwordExpiryDays" 
                min="0"
                max="365" />
              <small class="setting-hint">0 = no expiration</small>
            </div>
          </div>
          <div class="settings-row">
            <div class="setting-item">
              <label class="setting-label">Lockout Threshold</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="policy.maxFailedAttempts" 
                min="1"
                max="10" />
              <small class="setting-hint">Failed attempts before lockout</small>
            </div>
            <div class="setting-item">
              <label class="setting-label">Lockout Duration (min)</label>
              <input 
                type="number" 
                class="form-control" 
                [(ngModel)]="policy.lockoutDurationMinutes" 
                min="1"
                max="1440" />
              <small class="setting-hint">Minutes locked</small>
            </div>
          </div>
        </div>

        <!-- Save Button -->
        <div class="card-actions">
          <button 
            class="btn btn-primary btn-save" 
            (click)="save()" 
            [disabled]="saving || isLoading">
            <i class="fas fa-save" *ngIf="!saving"></i>
            <i class="fas fa-spinner fa-spin" *ngIf="saving"></i>
            <span>{{ saving ? 'Saving...' : 'Save Changes' }}</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Right Column: Password Tester -->
    <div class="password-tester-card">
      <div class="card-header">
        <h2>Password Tester</h2>
      </div>
      <div class="card-body">
        <div class="tester-content">
          <p class="tester-description">Test a password against the current policy settings</p>
          <div class="tester-input-group">
            <div class="input-wrapper">
              <i class="fas fa-key input-icon"></i>
              <input 
                [type]="showTestPassword ? 'text' : 'password'" 
                class="form-control tester-input" 
                placeholder="Enter password to test" 
                [(ngModel)]="testPassword"
                (keyup.enter)="runValidation()" />
              <button 
                type="button" 
                class="password-toggle"
                (click)="showTestPassword = !showTestPassword"
                tabindex="-1">
                <i class="fas" [class.fa-eye]="!showTestPassword" [class.fa-eye-slash]="showTestPassword"></i>
              </button>
            </div>
            <button 
              class="btn btn-primary btn-test" 
              (click)="runValidation()"
              [disabled]="!testPassword">
              <i class="fas fa-check"></i>
              <span>Test</span>
            </button>
          </div>
          <div class="tester-result" *ngIf="testResult">
            <!-- Result Header with Reset Button -->
            <div class="tester-result-header">
              <h3 class="result-title">Test Result</h3>
              <button 
                type="button" 
                class="btn-reset-tester" 
                (click)="resetTester()"
                title="Reset tester">
                <i class="fas fa-redo"></i>
                <span>Reset</span>
              </button>
            </div>
            
            <!-- Validation Status -->
            <div class="validation-status" [class.valid]="testResult.isValid" [class.invalid]="!testResult.isValid">
              <div class="status-icon">
                <i class="fas" [class.fa-check-circle]="testResult.isValid" [class.fa-times-circle]="!testResult.isValid"></i>
              </div>
              <div class="status-content">
                <div class="status-title">{{ testResult.isValid ? 'Password is Valid' : 'Password is Invalid' }}</div>
                <div class="status-subtitle" *ngIf="testResult.strengthLevel">
                  Strength: <span class="strength-badge" [class]="'strength-' + testResult.strengthLevel.toLowerCase()">{{ testResult.strengthLevel }}</span>
                  <span class="strength-score">(Score: {{ testResult.strengthScore || 0 }}/100)</span>
                </div>
              </div>
            </div>

            <!-- Errors -->
            <div class="validation-errors" *ngIf="testResult.errors && testResult.errors.length > 0">
              <div class="errors-header">
                <i class="fas fa-exclamation-circle"></i>
                <span>Errors ({{ testResult.errors.length }})</span>
              </div>
              <ul class="errors-list">
                <li *ngFor="let error of testResult.errors">
                  <i class="fas fa-times"></i>
                  <span>{{ error }}</span>
                </li>
              </ul>
            </div>

            <!-- Warnings -->
            <div class="validation-warnings" *ngIf="testResult.warnings && testResult.warnings.length > 0">
              <div class="warnings-header">
                <i class="fas fa-exclamation-triangle"></i>
                <span>Warnings ({{ testResult.warnings.length }})</span>
              </div>
              <ul class="warnings-list">
                <li *ngFor="let warning of testResult.warnings">
                  <i class="fas fa-exclamation"></i>
                  <span>{{ warning }}</span>
                </li>
              </ul>
            </div>

            <!-- Success Message -->
            <div class="validation-success" *ngIf="testResult.isValid && (!testResult.errors || testResult.errors.length === 0)">
              <i class="fas fa-check-circle"></i>
              <span>This password meets all policy requirements.</span>
            </div>

            <!-- Error Message -->
            <div class="validation-message" *ngIf="testResult.message && !testResult.errors">
              <i class="fas fa-info-circle"></i>
              <span>{{ testResult.message }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


